<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Medication Drips</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Tabular figures for numeric readouts */
    .tabular-nums { font-variant-numeric: tabular-nums; }
  </style>
</head>
<body class="min-h-screen w-full bg-zinc-50 text-zinc-900 dark:bg-zinc-900 dark:text-zinc-100 p-5 sm:p-8">
  <div class="mx-auto max-w-3xl">
    <header class="mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Medication Drips</h1>
      <p class="text-sm text-zinc-500 dark:text-zinc-400 mt-1">Weight-based infusion calculator for Dopamine, Dobutamine, and Norepinephrine.</p>
    </header>

    <!-- Weight Input -->
    <section class="mb-6">
      <label class="block text-xl font-semibold mb-2" for="weight">Weight (kg)</label>
      <div class="flex items-center gap-3">
        <input id="weight" type="number" inputmode="decimal" placeholder="e.g., 70"
               class="w-64 sm:w-72 text-lg rounded-2xl border border-zinc-300 bg-white dark:bg-zinc-800 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500" />
        <span id="weight-hint" class="text-xs text-zinc-500">Enter a positive weight to compute.</span>
      </div>
    </section>

    <!-- Reusable section template: we instantiate three below -->
    <template id="drug-section-template">
      <section class="mb-10">
        <div class="rounded-2xl border overflow-hidden shadow-sm">
          <div class="section-header text-white px-4 py-3">
            <h2 class="text-lg font-semibold section-title"></h2>
          </div>

          <div class="p-4 sm:p-5 space-y-5 bg-white dark:bg-zinc-800">
            <!-- Concentration -->
            <div>
              <div class="text-sm font-medium mb-2">Concentration</div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="flex flex-col">
                  <label class="text-xs text-zinc-500 mb-1">Drug (mg)</label>
                  <select class="mg rounded-xl border border-zinc-300 bg-white dark:bg-zinc-900 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></select>
                </div>
                <div class="flex flex-col">
                  <label class="text-xs text-zinc-500 mb-1">Dilution (mL)</label>
                  <select class="ml rounded-xl border border-zinc-300 bg-white dark:bg-zinc-900 px-3 py-2 focus:ring-2 focus:ring-indigo-500">
                    <option value="100">100 mL</option>
                    <option value="250">250 mL</option>
                  </select>
                </div>
              </div>
              <p class="text-xs text-zinc-500 mt-2">Concentration: <span class="font-medium conc">0</span> mcg/mL</p>
            </div>

            <!-- Dose -->
            <div>
              <div class="flex items-center justify-between mb-1">
                <div class="text-sm font-medium">Dose</div>
                <div class="text-sm tabular-nums"><span class="font-semibold dose-val">0</span> <span class="dose-unit">mcg/kg/min</span></div>
              </div>
              <input type="range" class="dose w-full" />
              <div class="flex justify-between text-[10px] text-zinc-500 mt-1">
                <span class="dose-min">0</span>
                <span class="dose-max">0</span>
              </div>
            </div>

            <!-- Rate -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="rounded-xl border border-zinc-200 dark:border-zinc-700 p-4">
                <div class="text-xs text-zinc-500">Rate</div>
                <div class="text-2xl font-bold tabular-nums"><span class="rate-min">0.000</span> <span class="text-base font-semibold ml-1">mL/min</span></div>
                <div class="text-xs text-zinc-500 mt-1">Computed from weight, dose, and concentration.</div>
              </div>
              <div class="rounded-xl border border-zinc-200 dark:border-zinc-700 p-4">
                <div class="text-xs text-zinc-500">Also handy</div>
                <div class="text-2xl font-bold tabular-nums"><span class="rate-hr">0.0</span> <span class="text-base font-semibold ml-1">mL/hr</span></div>
                <div class="text-xs text-zinc-500 mt-1">Same rate, per hour.</div>
              </div>
            </div>

            <!-- Formula -->
            <details class="rounded-xl border border-zinc-200 dark:border-zinc-700 p-4 bg-zinc-50 dark:bg-zinc-900">
              <summary class="cursor-pointer text-sm font-medium">Show formula</summary>
              <div class="mt-2 text-sm text-zinc-700 dark:text-zinc-300 space-y-1">
                <p><span class="font-semibold">rate (mL/min)</span> = [ <span class="font-mono">dose (mcg/kg/min)</span> × <span class="font-mono">weight (kg)</span> ] ÷ <span class="font-mono">concentration (mcg/mL)</span></p>
                <p><span class="font-semibold">concentration</span> = ( <span class="font-mono">drug (mg)</span> × 1000 ) ÷ <span class="font-mono">diluent (mL)</span></p>
              </div>
            </details>
          </div>
        </div>
      </section>
    </template>

    <!-- Sections mount here -->
    <div id="sections"></div>

    <footer class="text-xs text-zinc-500 dark:text-zinc-400">Built for quick bedside math. Verify against local protocols before use.</footer>
  </div>

  <script>
    // Utilities
    const fmt = (n, d = 3) => (isFinite(n) ? n.toFixed(d) : (0).toFixed(d));

    function makeSection({
      title,
      headerColor,
      borderColor,
      accentClass,
      mgOptions,
      dose: { min, max, step, unit },
    }) {
      const tpl = document.getElementById('drug-section-template').content.cloneNode(true);
      const root = tpl.querySelector('section > div');
      root.classList.add(...borderColor.split(' '));
      const header = tpl.querySelector('.section-header');
      header.classList.add(...headerColor.split(' '));
      tpl.querySelector('.section-title').textContent = title;

      const mgSel = tpl.querySelector('select.mg');
      mgOptions.forEach(mg => {
        const opt = document.createElement('option');
        opt.value = mg;
        opt.textContent = mg + ' mg';
        mgSel.appendChild(opt);
      });

      const mlSel = tpl.querySelector('select.ml');
      const concSpan = tpl.querySelector('.conc');
      const doseSlider = tpl.querySelector('input.dose');
      const doseVal = tpl.querySelector('.dose-val');
      const doseMin = tpl.querySelector('.dose-min');
      const doseMax = tpl.querySelector('.dose-max');
      const doseUnit = tpl.querySelector('.dose-unit');
      const rateMinOut = tpl.querySelector('.rate-min');
      const rateHrOut = tpl.querySelector('.rate-hr');

      doseSlider.min = String(min);
      doseSlider.max = String(max);
      doseSlider.step = String(step);
      doseSlider.value = String(min);
      doseMin.textContent = String(min);
      doseMax.textContent = String(max);
      doseUnit.textContent = unit;

      const state = {
        mg: Number(mgSel.value || mgOptions[0]),
        mL: Number(mlSel.value || 100),
        dose: Number(doseSlider.value),
        weight: 0,
      };

      function concentration() {
        return (state.mg * 1000) / state.mL; // mcg/mL
      }

      function update() {
        // weight
        const w = Number(document.getElementById('weight').value);
        state.weight = isFinite(w) ? w : 0;

        const conc = concentration();
        concSpan.textContent = fmt(conc, 0);

        // rate mL/min and mL/hr
        let rateMin = 0;
        if (state.weight > 0 && conc > 0) {
          rateMin = (state.dose * state.weight) / conc;
        }
        rateMinOut.textContent = fmt(rateMin, 3);
        rateHrOut.textContent = fmt(rateMin * 60, 1);

        // dose display
        doseVal.textContent = String(state.dose);

        // weight hint visibility
        document.getElementById('weight-hint').style.display = (state.weight > 0) ? 'none' : 'inline';
      }

      mgSel.addEventListener('change', (e) => { state.mg = Number(e.target.value); update(); });
      mlSel.addEventListener('change', (e) => { state.mL = Number(e.target.value); update(); });
      doseSlider.addEventListener('input', (e) => { state.dose = Number(e.target.value); update(); });
      document.getElementById('weight').addEventListener('input', update);

      // initial
      update();
      return tpl;
    }

    const sectionsRoot = document.getElementById('sections');

    // Dopamine
    sectionsRoot.appendChild(makeSection({
      title: 'Dopamine',
      headerColor: 'bg-indigo-600',
      borderColor: 'border border-indigo-200 dark:border-indigo-900',
      accentClass: 'accent-indigo-600',
      mgOptions: [200, 400, 800],
      dose: { min: 0, max: 20, step: 1, unit: 'mcg/kg/min' },
    }));

    // Dobutamine
    sectionsRoot.appendChild(makeSection({
      title: 'Dobutamine',
      headerColor: 'bg-teal-600',
      borderColor: 'border border-teal-200 dark:border-teal-900',
      accentClass: 'accent-teal-600',
      mgOptions: [250, 500, 1000],
      dose: { min: 0, max: 20, step: 1, unit: 'mcg/kg/min' },
    }));

    // Norepinephrine
    sectionsRoot.appendChild(makeSection({
      title: 'Norepinephrine',
      headerColor: 'bg-violet-600',
      borderColor: 'border border-violet-200 dark:border-violet-900',
      accentClass: 'accent-violet-600',
      mgOptions: [2, 4, 8, 16, 32], // mg options per your latest spec
      dose: { min: 0, max: 2, step: 0.1, unit: 'mcg/kg/min' },
    }));
  </script>
</body>
</html>
